<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XVQTC9C1DE"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag("js", new Date());
gtag("config", "G-XVQTC9C1DE");
</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClaudeSim ‚Äî Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root { --bg-primary:#0a0f1e;--bg-secondary:#0f172a;--bg-card:#151d30;--text-primary:#f1f5f9;--text-secondary:#cbd5e1;--text-muted:#94a3b8;--accent:#2563eb;--accent-light:#3b82f6;--accent-glow:rgba(37,99,235,0.3);--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--border:rgba(255,255,255,0.08);--border-accent:rgba(37,99,235,0.3); }
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;}
a{color:var(--accent-light);text-decoration:none;}
.container{max-width:1100px;margin:0 auto;padding:0 24px;}

/* NAV */
nav{background:var(--bg-secondary);border-bottom:1px solid var(--border);padding:14px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.nav-logo{font-size:20px;font-weight:800;} .nav-logo span{color:var(--accent-light);}
.nav-right{display:flex;align-items:center;gap:16px;}
.nav-right a{font-size:14px;color:var(--text-secondary);}
.nav-right a:hover{color:var(--text-primary);}
.btn{padding:10px 20px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;border:none;font-family:inherit;transition:all 0.2s;}
.btn-primary{background:linear-gradient(135deg,#1e3a5f,#2563eb);color:white;box-shadow:0 4px 20px var(--accent-glow);}
.btn-primary:hover{transform:translateY(-2px);}
.btn-secondary{background:transparent;color:var(--text-primary);border:1px solid var(--border);}
.btn-sm{padding:6px 14px;font-size:12px;}
.badge-plan{display:inline-block;padding:3px 10px;border-radius:999px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;}
.badge-plan.free{background:rgba(100,116,139,0.2);color:var(--text-muted);}
.badge-plan.pro{background:rgba(37,99,235,0.15);color:var(--accent-light);}

/* MAIN */
main{padding:40px 0;}
.welcome{margin-bottom:40px;}
.welcome h1{font-size:28px;font-weight:800;margin-bottom:4px;}
.welcome p{font-size:15px;color:var(--text-secondary);}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:40px;}
.stat-card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:20px;}
.stat-card .val{font-size:32px;font-weight:800;color:var(--accent-light);}
.stat-card .label{font-size:12px;color:var(--text-muted);margin-top:4px;}

/* COMPETENCIES RADAR */
.comp-section{margin-bottom:40px;}
.comp-section h2{font-size:20px;font-weight:700;margin-bottom:20px;}
.comp-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;}
.comp-card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:center;}
.comp-card .code{font-size:14px;font-weight:800;color:var(--accent-light);margin-bottom:4px;}
.comp-card .name{font-size:11px;color:var(--text-muted);margin-bottom:10px;}
.comp-card .score{font-size:28px;font-weight:800;}
.comp-card .bar{height:4px;background:rgba(255,255,255,0.06);border-radius:2px;margin-top:8px;overflow:hidden;}
.comp-card .bar-fill{height:100%;background:var(--accent);border-radius:2px;transition:width 0.5s;}

/* SCENARIOS */
.scenarios-section h2{font-size:20px;font-weight:700;margin-bottom:20px;}
.dash-tier-nav{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
.dash-tier-tab{background:var(--bg-card);border:2px solid var(--border);border-radius:10px;padding:12px 20px;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:10px;flex:1;min-width:180px;}
.dash-tier-tab:hover{border-color:var(--border-accent);background:var(--bg-card-hover);}
.dash-tier-tab.active{border-color:#f97316;background:rgba(249,115,22,0.08);}
.dash-tier-tab .dt-icon{font-size:20px;}
.dash-tier-tab .dt-info{display:flex;flex-direction:column;}
.dash-tier-tab .dt-name{font-size:13px;font-weight:700;color:var(--text-primary);}
.dash-tier-tab.active .dt-name{color:#f97316;}
.dash-tier-tab .dt-count{font-size:11px;color:var(--text-muted);}
.scenario-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;margin-bottom:40px;}
.sc-card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:20px;transition:all 0.3s;cursor:pointer;}
.sc-card:hover{border-color:var(--border-accent);transform:translateY(-2px);}
.sc-meta{display:flex;gap:6px;margin-bottom:8px;}
.sc-tag{font-size:10px;padding:2px 8px;border-radius:999px;font-weight:600;text-transform:uppercase;}
.sc-tag.domain{background:rgba(37,99,235,0.15);color:var(--accent-light);}
.sc-tag.level{background:rgba(16,185,129,0.15);color:#34d399;}
.sc-tag.free{background:rgba(245,158,11,0.15);color:#fbbf24;}
.sc-tag.pro{background:rgba(100,116,139,0.15);color:var(--text-muted);}
.sc-card h3{font-size:15px;font-weight:700;margin-bottom:6px;line-height:1.3;}
.sc-card p{font-size:12px;color:var(--text-secondary);}
.sc-footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding-top:10px;border-top:1px solid var(--border);}
.sc-footer span{font-size:11px;color:var(--text-muted);}

/* SESSIONS */
.sessions-section h2{font-size:20px;font-weight:700;margin-bottom:20px;}
.session-table{width:100%;border-collapse:collapse;}
.session-table th{text-align:left;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);padding:10px 12px;border-bottom:1px solid var(--border);}
.session-table td{padding:12px;font-size:13px;border-bottom:1px solid var(--border);}
.session-table tr:hover td{background:rgba(37,99,235,0.04);}
.status-badge{padding:3px 8px;border-radius:999px;font-size:10px;font-weight:700;text-transform:uppercase;}
.status-badge.completed{background:rgba(16,185,129,0.15);color:#34d399;}
.status-badge.active{background:rgba(245,158,11,0.15);color:#fbbf24;}
.status-badge.abandoned{background:rgba(100,116,139,0.15);color:var(--text-muted);}
.score-circle{display:inline-flex;width:36px;height:36px;border-radius:50%;align-items:center;justify-content:center;font-size:13px;font-weight:800;background:rgba(37,99,235,0.15);color:var(--accent-light);}

.empty-state{text-align:center;padding:60px 20px;color:var(--text-muted);}
.empty-state .icon{font-size:48px;margin-bottom:12px;}
.empty-state p{font-size:15px;margin-bottom:20px;}
.toast{position:fixed;top:60px;right:20px;padding:12px 20px;border-radius:8px;font-size:14px;z-index:100;transform:translateX(150%);transition:transform 0.3s;}
.toast.show{transform:translateX(0);}.toast.success{background:#065f46;color:#a7f3d0;border:1px solid #10b981;}.toast.error{background:#7f1d1d;color:#fecaca;border:1px solid #ef4444;}

@media(max-width:768px){.stats-grid{grid-template-columns:repeat(2,1fr);}.comp-grid{grid-template-columns:repeat(3,1fr);}.scenario-list{grid-template-columns:1fr;}.dash-tier-nav{flex-direction:column;}.dash-tier-tab{min-width:0;}}
</style>
</head>
<body>

<nav>
  <a href="/" class="nav-logo">Claude<span>Sim</span></a>
  <div class="nav-right">
    <a href="/" data-i18n="nav_home">Home</a>
    <a href="/admin" id="adminLink" style="display:none;color:#f59e0b;font-weight:600;">‚öôÔ∏è Admin</a>
    <span id="userPlan"></span>
    <span id="userName" style="font-size:14px;color:var(--text-secondary)"></span>
    <button onclick="toggleLang()" style="font-size:13px;color:var(--text-muted);border:1px solid rgba(255,255,255,0.08);padding:4px 10px;border-radius:6px;background:transparent;cursor:pointer;" id="langBtn">FR</button>
    <a href="#" onclick="logout()" style="font-size:13px;color:var(--text-muted)" data-i18n="nav_logout">Logout</a>
  </div>
</nav>

<main class="container">
  <div class="welcome">
    <h1 id="welcomeTitle">Welcome back!</h1>
    <p id="welcomeSub" data-i18n="dash_sub">Continue your AI literacy journey</p>
  </div>

  <!-- STATS -->
  <div class="stats-grid" id="statsGrid">
    <div class="stat-card"><div class="val" id="statSessions">0</div><div class="label" data-i18n="dash_total">Total Sessions</div></div>
    <div class="stat-card"><div class="val" id="statCompleted">0</div><div class="label" data-i18n="dash_completed">Completed</div></div>
    <div class="stat-card"><div class="val" id="statAvgScore">-</div><div class="label" data-i18n="dash_avg">Avg Score</div></div>
    <div class="stat-card"><div class="val" id="statRemaining">-</div><div class="label" data-i18n="dash_remaining">Simulations Left</div></div>
  </div>

  <!-- COMPETENCIES -->
  <div class="comp-section">
    <h2 data-i18n="dash_comp">Your Competencies</h2>
    <div class="comp-grid" id="compGrid">
      <div class="comp-card"><div class="code">C1</div><div class="name" data-i18n="c1">Clarity</div><div class="score" id="compC1">-</div><div class="bar"><div class="bar-fill" id="compBarC1" style="width:0%"></div></div></div>
      <div class="comp-card"><div class="code">C2</div><div class="name" data-i18n="c2">Techniques</div><div class="score" id="compC2">-</div><div class="bar"><div class="bar-fill" id="compBarC2" style="width:0%"></div></div></div>
      <div class="comp-card"><div class="code">C3</div><div class="name" data-i18n="c3">Iteration</div><div class="score" id="compC3">-</div><div class="bar"><div class="bar-fill" id="compBarC3" style="width:0%"></div></div></div>
      <div class="comp-card"><div class="code">C4</div><div class="name" data-i18n="c4">Critical</div><div class="score" id="compC4">-</div><div class="bar"><div class="bar-fill" id="compBarC4" style="width:0%"></div></div></div>
      <div class="comp-card"><div class="code">C5</div><div class="name" data-i18n="c5">Efficiency</div><div class="score" id="compC5">-</div><div class="bar"><div class="bar-fill" id="compBarC5" style="width:0%"></div></div></div>
      <div class="comp-card"><div class="code">C6</div><div class="name" data-i18n="c6">Ethics</div><div class="score" id="compC6">-</div><div class="bar"><div class="bar-fill" id="compBarC6" style="width:0%"></div></div></div>
    </div>
  </div>

  <!-- AVAILABLE SCENARIOS -->
  <div class="scenarios-section">
    <h2 data-i18n="dash_scenarios">Available Scenarios</h2>
    <div class="dash-tier-nav" id="dashTierNav">
      <div class="dash-tier-tab active" data-tier="1" onclick="selectDashTier(1)">
        <span class="dt-icon">üéØ</span>
        <div class="dt-info"><span class="dt-name" data-i18n="tier1_dash">Prompt Engineering</span><span class="dt-count" id="dashTierCount1">‚Äî</span></div>
      </div>
      <div class="dash-tier-tab" data-tier="2" onclick="selectDashTier(2)">
        <span class="dt-icon">üìã</span>
        <div class="dt-info"><span class="dt-name" data-i18n="tier2_dash">Specification Engineering</span><span class="dt-count" id="dashTierCount2">‚Äî</span></div>
      </div>
      <div class="dash-tier-tab" data-tier="3" onclick="selectDashTier(3)">
        <span class="dt-icon">üß≠</span>
        <div class="dt-info"><span class="dt-name" data-i18n="tier3_dash">Intent Engineering</span><span class="dt-count" id="dashTierCount3">‚Äî</span></div>
      </div>
    </div>
    <div class="scenario-list" id="scenarioList"></div>
  </div>

  <!-- SESSION HISTORY -->
  <div class="sessions-section">
    <h2 data-i18n="dash_history">Session History</h2>
    <div id="sessionsContainer"></div>
  </div>
</main>

<div class="toast" id="toast"></div>

<script>
const API = '';
const token = localStorage.getItem('auth_token');
if (!token) window.location.href = '/?error=auth_required';
const lang = localStorage.getItem('claudesim_lang') || 'en';
let userData = null;

const i18n = {
  fr: {
    nav_home: 'Accueil', nav_logout: 'D√©connexion',
    dash_sub: 'Continuez votre parcours en litt√©ratie IA',
    dash_total: 'Sessions totales', dash_completed: 'Compl√©t√©es', dash_avg: 'Score moyen', dash_remaining: 'Simulations restantes',
    dash_comp: 'Vos comp√©tences', dash_scenarios: 'Sc√©narios disponibles', dash_history: 'Historique des sessions',
    tier1_dash: 'Ing√©nierie de prompts', tier2_dash: 'Ing√©nierie de sp√©cifications', tier3_dash: 'Ing√©nierie d\'intention',
    c1: 'Clart√©', c2: 'Techniques', c3: 'It√©ration', c4: 'Esprit critique', c5: 'Efficacit√©', c6: '√âthique',
    th_scenario: 'Sc√©nario', th_domain: 'Domaine', th_status: 'Statut', th_score: 'Score', th_date: 'Date',
    btn_resume: 'Reprendre', btn_debrief: 'D√©brief',
    empty: 'Aucune session. Lancez votre premi√®re simulation !',
    payment_ok: 'Paiement r√©ussi ! Bienvenue dans Pro.'
  }
};

function applyLang() {
  if (lang !== 'fr') return;
  const t = i18n.fr;
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (t[key]) el.textContent = t[key];
  });
  document.getElementById('langBtn').textContent = 'EN';
}

function toggleLang() {
  const newLang = lang === 'en' ? 'fr' : 'en';
  localStorage.setItem('claudesim_lang', newLang);
  location.reload();
}

async function init() {
  applyLang();
  // Check payment success
  const params = new URLSearchParams(window.location.search);
  if (params.get('payment') === 'success') showToast(lang === 'fr' ? 'Paiement r√©ussi ! Bienvenue dans Pro.' : 'Payment successful! Welcome to Pro.', 'success');

  // Load user
  try {
    const res = await fetch(`${API}/api/auth/me`, { headers: { 'Authorization': `Bearer ${token}` } });
    if (!res.ok) { window.location.href = '/'; return; }
    const data = await res.json();
    userData = data.user;
    document.getElementById('userName').textContent = userData.name;
    const firstName = userData.name.split(' ')[0];
    document.getElementById('welcomeTitle').textContent = lang === 'fr' ? `Bon retour, ${firstName} !` : `Welcome back, ${firstName}!`;
    document.getElementById('userPlan').innerHTML = `<span class="badge-plan ${userData.plan}">${userData.plan}</span>`;
    if (userData.isAdmin) document.getElementById('adminLink').style.display = 'inline';
  } catch(e) { window.location.href = '/'; return; }

  loadDashboard();
  loadScenarios();
}

async function loadDashboard() {
  try {
    const res = await fetch(`${API}/api/user/dashboard`, { headers: { 'Authorization': `Bearer ${token}` } });
    const data = await res.json();

    // Stats
    document.getElementById('statSessions').textContent = data.stats.totalSessions;
    document.getElementById('statCompleted').textContent = data.stats.completedSessions;
    document.getElementById('statAvgScore').textContent = data.stats.avgScore || '-';
    const remaining = (userData.simulationsLimit || 1) - (userData.simulationsUsed || 0);
    if (userData.plan === 'free' && !userData.isAdmin) {
      document.getElementById('statRemaining').textContent = Math.max(0, remaining);
    } else {
      document.getElementById('statRemaining').textContent = '‚àû';
    }

    // Competencies
    data.progress.forEach(p => {
      const key = p.competency;
      const el = document.getElementById(`comp${key}`);
      const bar = document.getElementById(`compBar${key}`);
      if (el) el.textContent = p.level + '/5';
      if (bar) bar.style.width = (p.level / 5 * 100) + '%';
    });

    // Sessions
    const container = document.getElementById('sessionsContainer');
    if (data.sessions.length === 0) {
      container.innerHTML = `<div class="empty-state"><div class="icon">üéÆ</div><p>${lang === 'fr' ? 'Aucune session. Lancez votre premi√®re simulation !' : 'No sessions yet. Start your first simulation!'}</p></div>`;
    } else {
      const th = lang === 'fr' ? ['Sc√©nario','Domaine','Statut','Score','Date'] : ['Scenario','Domain','Status','Score','Date'];
      const btnResume = lang === 'fr' ? 'Reprendre' : 'Resume';
      const btnDebrief = lang === 'fr' ? 'D√©brief' : 'Debrief';
      container.innerHTML = `<table class="session-table"><thead><tr><th>${th[0]}</th><th>${th[1]}</th><th>${th[2]}</th><th>${th[3]}</th><th>${th[4]}</th><th></th></tr></thead><tbody>${data.sessions.map(s => `
        <tr>
          <td><strong>${lang === 'fr' ? s.title_fr : s.title_en}</strong></td>
          <td><span class="sc-tag domain">${s.domain}</span></td>
          <td><span class="status-badge ${s.status}">${s.status}</span></td>
          <td>${s.status === 'completed' ? `<span class="score-circle">${s.scoreGlobal}</span>` : '-'}</td>
          <td style="font-size:12px;color:var(--text-muted)">${new Date(s.startedAt).toLocaleDateString()}</td>
          <td>${s.status === 'active' ? `<a href="/simulation?session=${s.id}" class="btn btn-sm btn-primary">${btnResume}</a>` : s.status === 'completed' ? `<a href="/debrief?session=${s.id}" class="btn btn-sm btn-secondary">${btnDebrief}</a>` : ''}</td>
        </tr>`).join('')}</tbody></table>`;
    }
  } catch(e) { console.error('Dashboard error:', e); }
}

let dashAllScenarios = [];
let dashCurrentTier = 1;

async function loadScenarios() {
  try {
    const res = await fetch(`${API}/api/scenarios`);
    const data = await res.json();
    dashAllScenarios = data.scenarios || [];
    const isFreeUsed = userData.plan === 'free' && !userData.isAdmin && (parseInt(userData.simulationsUsed) || 0) >= 1;

    // Update tier counts
    [1,2,3].forEach(t => {
      const count = dashAllScenarios.filter(s => (s.tier || 1) === t).length;
      const el = document.getElementById(`dashTierCount${t}`);
      if (el) el.textContent = lang === 'fr' ? `${count} sc√©narios` : `${count} scenarios`;
    });

    renderDashScenarios(isFreeUsed);
  } catch(e) { console.error('Scenarios error:', e); }
}

function selectDashTier(tier) {
  dashCurrentTier = tier;
  gtag('event', 'select_tier', { tier_number: tier, tier_name: tier === 1 ? 'Prompt Engineering' : tier === 2 ? 'Specification Engineering' : 'Intent Engineering', page: 'dashboard' });
  document.querySelectorAll('.dash-tier-tab').forEach(t => t.classList.remove('active'));
  document.querySelector(`.dash-tier-tab[data-tier="${tier}"]`)?.classList.add('active');
  const isFreeUsed = userData.plan === 'free' && !userData.isAdmin && (parseInt(userData.simulationsUsed) || 0) >= 1;
  renderDashScenarios(isFreeUsed);
}

function renderDashScenarios(isFreeUsed) {
  const list = document.getElementById('scenarioList');
  const filtered = dashAllScenarios.filter(s => (s.tier || 1) === dashCurrentTier);

  if (filtered.length === 0) {
    list.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--text-muted);">${lang === 'fr' ? 'Sc√©narios bient√¥t disponibles.' : 'Scenarios coming soon.'}</div>`;
    return;
  }

  list.innerHTML = filtered.map(s => {
    const locked = !userData.isAdmin && userData.plan === 'free' && (!s.is_free || isFreeUsed);
    return `
    <div class="sc-card${locked ? ' locked' : ''}" onclick="startScenario(${s.id}, ${s.is_free})" style="${locked ? 'opacity:0.7;' : ''}">
      <div class="sc-meta">
        <span class="sc-tag domain">${s.domain}</span>
        <span class="sc-tag level">${s.level}</span>
        ${s.is_free && !isFreeUsed ? '<span class="sc-tag free">FREE</span>' : locked ? '<span class="sc-tag pro">üîí PRO</span>' : ''}
      </div>
      <h3>${lang === 'fr' ? s.title_fr : s.title_en}</h3>
      <p>${(lang === 'fr' ? (s.description_fr || s.description_en) : s.description_en).substring(0, 100)}...</p>
      <div class="sc-footer">
        <span>‚è± ${s.duration_min} min</span>
        <span>${(s.competencies || []).join(', ')}</span>
      </div>
    </div>`;
  }).join('');
}

function startScenario(id, isFree) {
  if (userData.plan === 'free' && !userData.isAdmin) {
    const used = parseInt(userData.simulationsUsed) || 0;
    if (!isFree || used >= 1) {
      gtag('event', 'upgrade_prompt', { scenario_id: id, tier: dashCurrentTier });
      showUpgradeModal();
      return;
    }
  }
  // Find scenario details for GA4
  const sc = dashAllScenarios.find(s => s.id === id);
  gtag('event', 'start_simulation', {
    scenario_id: id,
    scenario_code: sc?.code || '',
    tier_number: sc?.tier || dashCurrentTier,
    domain: sc?.domain || '',
    level: sc?.level || ''
  });
  window.location.href = `/simulation?scenario=${id}`;
}

function showUpgradeModal() {
  // Remove any existing modal first
  const existing = document.getElementById('upgradeModal');
  if (existing) existing.remove();

  const title = lang==='fr' ? 'Passez √† Pro' : 'Upgrade to Pro';
  const text = lang==='fr'
    ? 'Vous avez utilis√© votre simulation gratuite. Passez √† Pro pour un acc√®s illimit√© √† tous les sc√©narios.'
    : 'You\'ve used your free simulation. Upgrade to Pro for unlimited access to all scenarios.';
  const back = lang==='fr' ? '‚Üê Retour au tableau de bord' : '‚Üê Back to Dashboard';
  const modal = document.createElement('div');
  modal.id = 'upgradeModal';
  modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(6px);z-index:200;display:flex;align-items:center;justify-content:center;';
  modal.innerHTML = `<div style="background:var(--bg-card);border:1px solid rgba(37,99,235,0.3);border-radius:16px;padding:40px;max-width:480px;text-align:center;">
    <div style="font-size:48px;margin-bottom:12px;">üîí</div>
    <h2 style="font-size:24px;font-weight:800;margin-bottom:8px;">${title}</h2>
    <p style="font-size:15px;color:var(--text-secondary);margin-bottom:28px;line-height:1.6;">${text}</p>
    <div style="display:flex;gap:12px;margin-bottom:20px;">
      <a href="/#pricing" style="flex:1;background:var(--bg-secondary);border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:20px 16px;text-decoration:none;display:block;">
        <div style="font-size:28px;font-weight:800;color:#3b82f6;">$19</div>
        <div style="font-size:13px;color:var(--text-muted);">${lang==='fr'?'/mois':'/month'}</div>
        <div style="font-size:12px;font-weight:600;margin-top:8px;color:var(--text-secondary);">${lang==='fr'?'Pro Mensuel':'Pro Monthly'}</div>
      </a>
      <a href="/#pricing" style="flex:1;background:var(--bg-secondary);border:1px solid var(--accent);border-radius:12px;padding:20px 16px;text-decoration:none;display:block;position:relative;">
        <div style="position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:var(--accent);padding:2px 12px;border-radius:999px;font-size:10px;font-weight:700;color:white;">${lang==='fr'?'MEILLEUR CHOIX':'BEST VALUE'}</div>
        <div style="font-size:28px;font-weight:800;color:#3b82f6;">$149</div>
        <div style="font-size:13px;color:var(--text-muted);">${lang==='fr'?'une fois':'once'}</div>
        <div style="font-size:12px;font-weight:600;margin-top:8px;color:var(--text-secondary);">${lang==='fr'?'Pro √† vie':'Pro Lifetime'}</div>
      </a>
    </div>
    <button onclick="document.getElementById('upgradeModal').remove()" style="background:none;border:none;color:var(--text-muted);font-size:13px;cursor:pointer;font-family:inherit;">${back}</button>
  </div>`;
  document.body.appendChild(modal);
  modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
}

// Clear any stuck overlay on page load
window.addEventListener('load', () => {
  const stuck = document.getElementById('upgradeModal');
  if (stuck && !document.querySelector('.scenario-card[onclick]')) stuck.remove();
});

function logout() { localStorage.removeItem('auth_token'); window.location.href = '/'; }
function showToast(msg, type) { const t = document.getElementById('toast'); t.textContent = msg; t.className = `toast ${type} show`; setTimeout(() => t.classList.remove('show'), 3500); }

init();
</script>
</body>
</html>
